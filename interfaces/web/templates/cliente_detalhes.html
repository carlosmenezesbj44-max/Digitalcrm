{% extends "layout.html" %}

{% block title %}Detalhes do Cliente - {{ cliente.nome }} - CRM Provedor{% endblock %}

{% block extra_css %}
<style>
    .cliente-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 28px;
        font-weight: bold;
        margin: 0 auto 15px;
    }
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
    }
    .status-online { background-color: var(--success-color); }
    .status-offline { background-color: var(--text-secondary); }
    .info-card {
        background: var(--card-bg);
        border: 0;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        transition: transform 0.2s;
    }
    .info-card:hover {
        transform: translateY(-2px);
    }
    .tab-content {
        padding: 20px 0;
    }
    .contrato-item {
        border-left: 4px solid var(--primary-color);
        padding-left: 15px;
        margin-bottom: 15px;
    }
    .contrato-assinado { border-left-color: var(--success-color); }
    .contrato-pendente { border-left-color: var(--warning-color); }
    .contrato-inativo { border-left-color: var(--text-secondary); }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Cabeçalho com Avatar e Ações -->
    <div class="card mb-4 info-card">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-2 text-center">
                    <div class="cliente-avatar">
                        {{ cliente.nome[0].upper() }}
                    </div>
                </div>
                <div class="col-md-6">
                    <h2 class="mb-1" style="color: var(--text-main);">{{ cliente.nome }}</h2>
                    <p class="mb-2" style="color: var(--text-secondary);">{{ cliente.email }}</p>
                    <div class="d-flex gap-2 mb-2">
                        <span class="status-indicator {% if cliente.online %}status-online{% else %}status-offline{% endif %}"></span>
                        <span class="{% if cliente.online %}text-success{% else %}{% endif %}" style="{% if not cliente.online %}color: var(--text-secondary);{% endif %}">
                            {% if cliente.online %}Online{% else %}Offline{% endif %}
                        </span>
                        {% if cliente.status_contrato == "assinado" %}
                            <span class="badge bg-success">Contrato Assinado</span>
                        {% elif cliente.status_contrato == "aguardando_assinatura" %}
                            <span class="badge bg-warning text-dark">Aguardando Assinatura</span>
                        {% else %}
                            <span class="badge bg-secondary">Sem Contrato</span>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="tel:{{ cliente.telefone }}" class="btn btn-outline-primary">
                            <i class="bi bi-telephone"></i> Ligar
                        </a>
                        <a href="https://wa.me/{{ cliente.whatsapp|replace(' ', '')|replace('-', '')|replace('(', '')|replace(')', '') }}" target="_blank" class="btn btn-outline-success">
                            <i class="bi bi-whatsapp"></i> WhatsApp
                        </a>
                        <a href="/clientes/{{ cliente.id }}/editar" class="btn btn-outline-secondary">
                            <i class="bi bi-pencil"></i> Editar
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Diagnóstico e Testes -->
        <div class="col-md-4">
            <div class="card mb-4 border-0 shadow-sm" style="background: var(--card-bg);">
                <div class="modal-header border-bottom-0 pt-4 px-4">
                    <h5 class="modal-title fw-bold" style="color: var(--text-main);"><i class="bi bi-box-seam"></i> Produtos Adicionais</h5>
                </div>
                <div class="card-body p-4">
                    {% if cliente.produto_ids %}
                        <div class="list-group list-group-flush">
                        {% for produto in produtos %}
                            {% if produto.id in cliente.produto_ids %}
                                <div class="list-group-item bg-transparent border-0 px-0 py-2 d-flex justify-content-between align-items-center">
                                    <div style="color: var(--text-main);">
                                        <i class="bi bi-check-circle text-success me-2"></i> {{ produto.nome }}
                                        <div class="small text-muted">{{ produto.tipo }}</div>
                                    </div>
                                    <span class="badge bg-primary rounded-pill">R$ {{ "%.2f"|format(produto.preco) }}</span>
                                </div>
                            {% endif %}
                        {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted mb-0">Nenhum produto adicional contratado.</p>
                    {% endif %}
                    {% if cliente.valor_total is not none %}
                        <hr class="my-3">
                        <div class="d-flex justify-content-between align-items-center fw-bold" style="color: var(--text-main);">
                            <span>Valor Total (Plano + Produtos):</span>
                            <span>R$ {{ "%.2f"|format(cliente.valor_total) }}</span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="card mb-4 border-0 shadow-sm" style="background: var(--card-bg);">
                <div class="modal-header border-bottom-0 pt-4 px-4">
                    <h5 class="modal-title fw-bold" style="color: var(--text-main);"><i class="bi bi-router"></i> Diagnóstico</h5>
                </div>
                <div class="card-body p-4">
                    <div class="d-grid gap-2">
                        <button id="btnPing" onclick="fazerPing()" class="btn btn-outline-primary text-start">
                            <i class="bi bi-router"></i> Testar Conexão (Ping)
                        </button>
                        <button onclick="sincronizarMikrotik()" class="btn btn-outline-secondary text-start">
                            <i class="bi bi-arrow-repeat"></i> Sincronizar Mikrotik
                        </button>
                        <button onclick="verLogsMikrotik()" class="btn btn-outline-secondary text-start">
                            <i class="bi bi-journal-text"></i> Ver Logs Mikrotik
                        </button>
                        <button onclick="verSessoesMikrotik()" class="btn btn-outline-secondary text-start">
                            <i class="bi bi-eye"></i> Ver Sessões Mikrotik
                        </button>
                        <button onclick="resetarConexao()" class="btn btn-outline-danger text-start">
                            <i class="bi bi-bootstrap-reboot"></i> Resetar Conexão
                        </button>
                    </div>

                    <div id="pingDetails" class="mt-4" style="display: none;">
                        <div id="pingAlert" class="alert mb-0" role="alert"></div>
                        <div id="pingResult" class="mt-2 text-center h4"></div>
                    </div>
                </div>
            </div>

            <!-- Foto da Casa -->
            <div class="card mb-4 border-0 shadow-sm" style="background: var(--card-bg);">
                <div class="modal-header border-bottom-0 pt-4 px-4">
                    <h5 class="modal-title fw-bold" style="color: var(--text-main);"><i class="bi bi-house"></i> Foto da Casa</h5>
                </div>
                <div class="card-body p-4 text-center">
                    {% if cliente.foto_casa %}
                        <img src="{{ cliente.foto_casa }}" alt="Foto da Casa" class="img-fluid rounded shadow-sm mb-3" style="max-height: 250px; width: 100%; object-fit: cover;">
                        <a href="{{ cliente.foto_casa }}" target="_blank" class="btn btn-sm btn-outline-primary w-100">
                            <i class="bi bi-arrows-fullscreen"></i> Ver em Tamanho Real
                        </a>
                    {% else %}
                        <div class="py-4 text-muted">
                            <i class="bi bi-image" style="font-size: 3rem; opacity: 0.5;"></i>
                            <p class="mt-2 mb-0">Nenhuma foto anexada</p>
                            <a href="/clientes/{{ cliente.id }}/editar" class="btn btn-sm btn-link mt-2">Adicionar Foto</a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="card mb-4 border-0 shadow-sm" style="background: var(--card-bg);">
                <div class="modal-header border-bottom-0 pt-4 px-4">
                    <h5 class="modal-title fw-bold" style="color: var(--text-main);"><i class="bi bi-info-circle"></i> Informações de Rede</h5>
                </div>
                <div class="card-body p-4">
                    <p class="mb-2" style="color: var(--text-secondary);"><strong>Username:</strong> <span style="color: var(--text-main);">{{ cliente.username or 'N/A' }}</span></p>
                    <p class="mb-2" style="color: var(--text-secondary);"><strong>IP Atual:</strong> <span style="color: var(--text-main);">{{ cliente.ip_atual or 'Não conectado' }}</span></p>
                    <p class="mb-2" style="color: var(--text-secondary);"><strong>Plano:</strong> <span style="color: var(--text-main);">{{ cliente.plano_id or 'N/A' }}</span></p>
                    <p class="mb-0" style="color: var(--text-secondary);"><strong>Servidor:</strong> <span style="color: var(--text-main);">{{ cliente.servidor_id or 'N/A' }}</span></p>
                </div>
            </div>
        </div>

        <!-- Abas de Conteúdo -->
        <div class="col-md-8">
            <div class="card border-0 shadow-sm" style="background: var(--card-bg);">
                <div class="card-header border-bottom-0 pt-4 px-4 bg-transparent">
                    <ul class="nav nav-tabs border-0" id="clienteTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active fw-bold border-0 bg-transparent py-2" id="historico-tab" data-bs-toggle="tab" data-bs-target="#historico" type="button" role="tab" style="color: var(--text-main);">
                                <i class="bi bi-clock-history"></i> Histórico
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link fw-bold border-0 bg-transparent py-2 ms-3" id="arquivos-tab" data-bs-toggle="tab" data-bs-target="#arquivos" type="button" role="tab" style="color: var(--text-secondary);">
                                <i class="bi bi-file-earmark-text"></i> Arquivos
                            </button>
                        </li>
                    </ul>
                </div>
                
                <div class="tab-content" id="clienteTabsContent">
                    <!-- Histórico de Conexões -->
                    <div class="tab-pane fade show active" id="historico" role="tabpanel">
                        <div class="modal-header border-bottom-0 pt-2 px-4 d-flex justify-content-between align-items-center">
                            <h5 class="modal-title fw-bold" style="color: var(--text-main);"></h5>
                            <div class="btn-group btn-group-sm">
                                <button onclick="filtrarHistorico('today')" class="btn btn-outline-secondary">Hoje</button>
                                <button onclick="filtrarHistorico('week')" class="btn btn-outline-secondary">Semana</button>
                                <button onclick="filtrarHistorico('month')" class="btn btn-outline-secondary">Mês</button>
                                <button onclick="recarregarHistorico()" class="btn btn-outline-primary"><i class="bi bi-arrow-clockwise"></i></button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div id="historicoList">
                                <div class="text-center py-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Carregando...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Arquivos do Cliente -->
                    <div class="tab-pane fade" id="arquivos" role="tabpanel">
                        <div class="modal-header border-bottom-0 pt-2 px-4 d-flex justify-content-between align-items-center">
                            <h5 class="modal-title fw-bold" style="color: var(--text-main);"><i class="bi bi-folder"></i> Documentos Anexados</h5>
                            <a href="/clientes/{{ cliente.id }}/editar#arquivos" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-plus-lg"></i> Adicionar Arquivos
                            </a>
                        </div>
                        <div class="card-body p-4">
                            {% if cliente.arquivos %}
                                <div class="row row-cols-1 row-cols-md-2 g-3">
                                    {% for arquivo in cliente.arquivos %}
                                        <div class="col" id="arquivo-{{ arquivo.id }}">
                                            <div class="d-flex align-items-center p-3 border rounded shadow-sm hover-shadow transition" style="background: rgba(var(--primary-color-rgb), 0.02);">
                                                <div class="flex-shrink-0 me-3">
                                                    {% set ext = arquivo.filename.split('.')[-1].lower() %}
                                                    {% if ext in ['jpg', 'jpeg', 'png', 'gif'] %}
                                                        <i class="bi bi-file-earmark-image text-primary h3 mb-0"></i>
                                                    {% elif ext == 'pdf' %}
                                                        <i class="bi bi-file-earmark-pdf text-danger h3 mb-0"></i>
                                                    {% elif ext in ['doc', 'docx'] %}
                                                        <i class="bi bi-file-earmark-word text-primary h3 mb-0"></i>
                                                    {% else %}
                                                        <i class="bi bi-file-earmark-text text-secondary h3 mb-0"></i>
                                                    {% endif %}
                                                </div>
                                                <div class="flex-grow-1 overflow-hidden">
                                                    <h6 class="mb-1 text-truncate" title="{{ arquivo.filename }}">{{ arquivo.filename }}</h6>
                                                    <small class="text-muted">{{ arquivo.data_upload.strftime('%d/%m/%Y %H:%M') }}</small>
                                                </div>
                                                <div class="flex-shrink-0 ms-2">
                                                    <div class="btn-group btn-group-sm">
                                                        <a href="{{ arquivo.filepath }}" target="_blank" class="btn btn-outline-primary" title="Ver Arquivo">
                                                            <i class="bi bi-eye"></i>
                                                        </a>
                                                        <button onclick="excluirArquivo({{ arquivo.id }})" class="btn btn-outline-danger" title="Excluir">
                                                            <i class="bi bi-trash"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-5">
                                    <i class="bi bi-file-earmark-x display-4 text-muted mb-3"></i>
                                    <h5 class="text-muted">Nenhum arquivo anexado</h5>
                                    <p class="text-muted">Você pode anexar documentos como CPF, RG e comprovantes na página de edição.</p>
                                    <a href="/clientes/{{ cliente.id }}/editar#arquivos" class="btn btn-primary mt-3">
                                        <i class="bi bi-upload"></i> Upload de Documentos
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Sincronizar menus após carregamento
    document.addEventListener('DOMContentLoaded', function() {
        recarregarHistorico();

        // Gerenciar troca de abas
        const tabs = document.querySelectorAll('#clienteTabs button');
        tabs.forEach(tab => {
            tab.addEventListener('shown.bs.tab', function (event) {
                // Resetar cores de todas as abas
                tabs.forEach(t => t.style.color = 'var(--text-secondary)');
                // Destacar aba ativa
                event.target.style.color = 'var(--text-main)';
            });
        });

        // Verificar se há hash na URL para abrir aba específica
        if (window.location.hash === '#arquivos') {
            const arquivostab = document.getElementById('arquivos-tab');
            if (arquivostab) arquivostab.click();
        }
    });

    // Função para excluir arquivo
    async function excluirArquivo(arquivoId) {
        if (!confirm('Tem certeza que deseja excluir este arquivo permanentemente?')) return;

        try {
            const response = await fetch(`/api/v1/clientes/arquivos/${arquivoId}`, {
                method: 'DELETE'
            });
            const data = await response.json();

            if (response.ok) {
                const element = document.getElementById(`arquivo-${arquivoId}`);
                if (element) {
                    element.classList.add('fade-out');
                    setTimeout(() => {
                        element.remove();
                        showToast('Arquivo excluído com sucesso!', 'success');
                        
                        // Se não houver mais arquivos, recarregar para mostrar mensagem de vazio
                        const remaining = document.querySelectorAll('#arquivos .col');
                        if (remaining.length === 0) {
                            location.reload();
                        }
                    }, 300);
                } else {
                    location.reload();
                }
            } else {
                showToast('Erro ao excluir arquivo: ' + (data.detail || 'Erro desconhecido'), 'error');
            }
        } catch (error) {
            showToast('Erro na requisição: ' + error.message, 'error');
        }
    }

    // Função para executar ping test
    async function fazerPing() {
        const btn = document.getElementById('btnPing');
        const result = document.getElementById('pingResult');
        const details = document.getElementById('pingDetails');
        const alert = document.getElementById('pingAlert');

        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Testando...';
        result.innerHTML = '';

        try {
            const response = await fetch(`/clientes/{{ cliente.id }}/ping`);
            const data = await response.json();

            if (data.success) {
                result.innerHTML = '<i class="bi bi-check-circle text-success"></i> <strong>' +
                    (data.latency ? data.latency.toFixed(1) + 'ms' : 'OK') + '</strong>';
                alert.className = 'alert alert-success border-0 shadow-sm';
                alert.style.background = 'rgba(46, 204, 113, 0.1)';
                alert.style.color = '#2ecc71';
                alert.innerHTML = '<i class="bi bi-check-circle"></i> <strong>Ping bem-sucedido!</strong><br>' +
                    (data.latency ? 'Latência: ' + data.latency.toFixed(1) + 'ms' : 'Conexão estabelecida');
                btn.innerHTML = '<i class="bi bi-router"></i> Testar Novamente';
            } else {
                result.innerHTML = '<i class="bi bi-x-circle text-danger"></i> <strong>Falhou</strong>';
                alert.className = 'alert alert-danger border-0 shadow-sm';
                alert.style.background = 'rgba(231, 76, 60, 0.1)';
                alert.style.color = '#e74c3c';
                alert.innerHTML = '<i class="bi bi-x-circle"></i> <strong>Erro no ping:</strong> ' + (data.error || 'Erro desconhecido');
                btn.innerHTML = '<i class="bi bi-router"></i> Tentar Novamente';
            }

            details.style.display = 'block';

            // Recarregar histórico após 3 segundos
            setTimeout(() => {
                recarregarHistorico();
            }, 3000);

        } catch (error) {
            result.innerHTML = '<i class="bi bi-x-circle text-danger"></i> <strong>Erro</strong>';
            alert.className = 'alert alert-danger border-0 shadow-sm';
            alert.style.background = 'rgba(231, 76, 60, 0.1)';
            alert.style.color = '#e74c3c';
            alert.innerHTML = '<i class="bi bi-exclamation-triangle"></i> <strong>Erro na requisição:</strong> ' + error.message;
            details.style.display = 'block';
            btn.innerHTML = '<i class="bi bi-router"></i> Tentar Novamente';
        } finally {
            btn.disabled = false;
        }
    }

    // Função para sincronizar com Mikrotik
    async function sincronizarMikrotik() {
        if (!confirm('Tem certeza que deseja sincronizar este cliente com o Mikrotik?')) return;

        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Sincronizando...';

        try {
            const response = await fetch(`/clientes/{{ cliente.id }}/sincronizar-mikrotik`, {
                method: 'POST'
            });
            const data = await response.json();

            if (data.success) {
                showToast('Sucesso', 'Cliente sincronizado com sucesso no Mikrotik!');
                location.reload();
            } else {
                showToast('Erro', 'Erro na sincronização: ' + (data.error || 'Erro desconhecido'), 'danger');
            }
        } catch (error) {
            showToast('Erro', 'Erro na requisição: ' + error.message, 'danger');
        } finally {
            btn.disabled = false;
            btn.innerHTML = originalText;
        }
    }

    // Função para ver logs do Mikrotik
    function verLogsMikrotik() {
        window.open('/mikrotik/logs?cliente_id={{ cliente.id }}', '_blank');
    }

    // Função para ver sessões do Mikrotik
    function verSessoesMikrotik() {
        window.open('/mikrotik/sessions?cliente_id={{ cliente.id }}', '_blank');
    }

    // Função para resetar conexão
    async function resetarConexao() {
        if (!confirm('Tem certeza que deseja resetar a conexão deste cliente?')) return;

        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Resetando...';

        try {
            const response = await fetch(`/clientes/{{ cliente.id }}/resetar-conexao`, {
                method: 'POST'
            });
            const data = await response.json();

            if (data.success) {
                showToast('Sucesso', 'Conexão resetada com sucesso!');
                setTimeout(() => {
                    recarregarHistorico();
                }, 2000);
            } else {
                showToast('Erro', 'Erro ao resetar conexão: ' + (data.error || 'Erro desconhecido'), 'danger');
            }
        } catch (error) {
            showToast('Erro', 'Erro na requisição: ' + error.message, 'danger');
        } finally {
            btn.disabled = false;
            btn.innerHTML = originalText;
        }
    }

    // Função para filtrar histórico
    function filtrarHistorico(periodo) {
        const items = document.querySelectorAll('.log-item');
        const now = new Date();

        items.forEach(item => {
            const timestampText = item.querySelector('.text-muted').textContent.trim();
            // Tentar extrair a data do texto (formato pt-BR: dd/mm/aaaa hh:mm:ss)
            const datePart = timestampText.split(' ')[0];
            const [day, month, year] = datePart.split('/');
            const logDate = new Date(year, month - 1, day);

            let show = true;

            switch (periodo) {
                case 'today':
                    show = logDate.toDateString() === now.toDateString();
                    break;
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    show = logDate >= weekAgo;
                    break;
                case 'month':
                    const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                    show = logDate >= monthAgo;
                    break;
            }

            item.style.display = show ? '' : 'none';
        });
    }

    // Função para recarregar histórico
    async function recarregarHistorico() {
        try {
            const response = await fetch(`/clientes/{{ cliente.id }}/historico`);
            const data = await response.json();

            if (data.success) {
                const historicoList = document.getElementById('historicoList');
                historicoList.innerHTML = '';

                if (data.historico && data.historico.length > 0) {
                    data.historico.forEach(log => {
                        const logItem = document.createElement('div');
                        logItem.className = 'd-flex align-items-center p-3 border-bottom log-item';
                        logItem.style.borderColor = 'var(--border-color) !important';

                        const badgeClass = getBadgeClass(log.status);
                        const iconClass = getIconClass(log.status);

                        logItem.innerHTML = `
                            <div class="flex-shrink-0 me-3">
                                <span class="badge ${badgeClass} p-2 rounded-circle">
                                    <i class="bi ${iconClass}"></i>
                                </span>
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1 fw-bold" style="color: var(--text-main);">${log.status.charAt(0).toUpperCase() + log.status.slice(1)}</h6>
                                        <small class="text-muted">
                                            ${new Date(log.timestamp).toLocaleString('pt-BR')}
                                            ${log.ip_address ? ' • IP: ' + log.ip_address : ''}
                                        </small>
                                    </div>
                                    <div class="text-end">
                                        ${log.latency_ms ? '<span class="badge bg-success-soft">' + log.latency_ms.toFixed(1) + 'ms</span>' : ''}
                                    </div>
                                </div>
                                ${log.details ? '<p class="mb-0 mt-2 text-muted small">' + log.details + '</p>' : ''}
                            </div>
                        `;

                        historicoList.appendChild(logItem);
                    });
                } else {
                    historicoList.innerHTML = `
                        <div class="text-center py-5">
                            <i class="bi bi-clock-history display-4 text-muted mb-3"></i>
                            <h5 class="text-muted">Nenhum histórico disponível</h5>
                            <p class="text-muted">O histórico de conexões aparecerá aqui conforme o cliente se conectar.</p>
                        </div>
                    `;
                }
            }
        } catch (error) {
            console.error('Erro ao recarregar histórico:', error);
        }
    }

    // Funções auxiliares para classes de badges e ícones
    function getBadgeClass(status) {
        switch (status) {
            case 'online': return 'bg-success';
            case 'offline': return 'bg-secondary';
            case 'ping_test': return 'bg-info';
            case 'login': return 'bg-primary';
            case 'logout': return 'bg-warning';
            default: return 'bg-light text-dark';
        }
    }

    function getIconClass(status) {
        switch (status) {
            case 'online': return 'bi-wifi';
            case 'offline': return 'bi-wifi-off';
            case 'ping_test': return 'bi-router';
            case 'login': return 'bi-box-arrow-in-right';
            case 'logout': return 'bi-box-arrow-right';
            default: return 'bi-info-circle';
        }
    }
</script>
{% endblock %}

